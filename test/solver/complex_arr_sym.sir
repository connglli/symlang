// EXPECT: PASS
// ARGS: --main @main --path '^entry'

// Test symbolic index assignment in array wrapped in struct.
// Write 99 to symbolic index. Read index 2.
// For read to be 99, symbolic index must be 2.

struct @Data { arr: [4]i32; }

fun @main() : i32 {
  sym %?idx : value i32 in [0, 3];
  let mut %d: @Data;
  let mut %val: i32 = 0;

^init:
  %d.arr[0] = 10;
  %d.arr[1] = 20;
  %d.arr[2] = 30;
  %d.arr[3] = 40;
  br ^entry;

^entry:
  // d.arr[?idx] = 99
  %d.arr[%?idx] = 99;

  // val = d.arr[2]
  %val = %d.arr[2];

  require %val == 99;

  ret 0;
}

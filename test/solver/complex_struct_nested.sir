// EXPECT: PASS
// SOLVER_ARGS: --main @main --path '^entry,^target'
// INTERP_ARGS: --main @main --sym %?v=55
// COMPILER_ARGS: --main @main --sym %?v=55

// Test nested struct updates and preservation of other fields.
// l.p2.y = ?v should not affect l.p1.y

struct @Point { x: i32; y: i32; }
struct @Line { p1: @Point; p2: @Point; }

fun @main() : i32 {
  sym %?v : value i32 in [0, 100];
  let mut %l: @Line;
  let mut %chk1: i32 = 0;
  let mut %chk2: i32 = 0;

^entry:
  %l.p1.x = 1;
  %l.p1.y = 2;
  %l.p2.x = 3;
  %l.p2.y = 4;
  br ^target;

^target:
  %l.p2.y = %?v;

  // Check unrelated field preserved
  %chk1 = %l.p1.y;
  require %chk1 == 2, "unrelated field p1.y should be preserved";

  // Check target field updated
  %chk2 = %l.p2.y;
  require %chk2 == 55, "target field p2.y should be updated to 55";

  ret 0;
}

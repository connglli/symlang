// EXPECT: PASS
// Valid Parentheses Simulation
// Stack based. "((()))" -> valid (1)

struct @Stack { data: [10]i32; top: i32; }
struct @Result { valid: i32; depth: i32; }

fun @main() : i32 {
  let mut %s: @Stack;
  let %str: [6]i32 = {40, 40, 40, 41, 41, 41}; // '(', '(', '(', ')', ')', ')'
  let mut %i: i32 = 0;
  let mut %res: @Result;
  let mut %c: i32 = 0;
  let mut %popped: i32 = 0;
  let mut %top: i32 = 0;

^init:
  %s.top = 0;
  %res.valid = 1;
  %res.depth = 0;
  br ^loop;

^loop:
  br %i < 6, ^process, ^check_empty;

^process:
  %c = %str[%i];
  br %c == 40, ^push, ^pop;

^push:
  %top = %s.top;
  br %top < 10, ^do_push, ^fail;

^do_push:
  %s.data[%top] = %c;
  %s.top = %top + 1;
  %i = %i + 1;
  br ^loop;

^pop:
  %top = %s.top;
  br %top > 0, ^do_pop, ^fail;

^do_pop:
  %top = %top - 1;
  %s.top = %top;
  %popped = %s.data[%top];
  br %popped == 40, ^pop_ok, ^fail;

^pop_ok:
  %i = %i + 1;
  br ^loop;

^fail:
  %res.valid = 0;
  br ^finish;

^check_empty:
  %top = %s.top;
  br %top == 0, ^success, ^fail;

^success:
  %res.valid = 1;
  br ^finish;

^finish:
  require %res.valid == 1;
  ret %res.valid;
}

// EXPECT: PASS
// Longest Common Subsequence of two sequences
// Logic: DP table 2D array
// X: {1, 2, 3, 4, 1, 2, 3, 4, 5, 6}
// Y: {1, 3, 4, 5, 6, 7, 8, 9, 1, 2}
// Common: 1, 3, 4, 5, 6 (Length 5)

struct @Sequence { data: [10]i32; }
struct @LCSResult { len: i32; match_count: i32; }

fun @main() : i32 {
  let %X: @Sequence = { {1, 2, 3, 4, 1, 2, 3, 4, 5, 6} };
  let %Y: @Sequence = { {1, 3, 4, 5, 6, 7, 8, 9, 1, 2} };
  let mut %dp: [11][11]i32 = 0; // Initialize DP table with 0
  let mut %i: i32 = 0;
  let mut %j: i32 = 0;
  let mut %im1: i32 = 0;
  let mut %jm1: i32 = 0;
  let mut %valX: i32 = 0;
  let mut %valY: i32 = 0;
  let mut %prev: i32 = 0;
  let mut %up: i32 = 0;
  let mut %left: i32 = 0;
  let mut %mx: i32 = 0;
  let mut %res: @LCSResult;

  // Initialize DP table (loops are explicit in SymIR)
^init_outer:
  %i = 0;
  br ^loop_init_outer_cond;

^loop_init_outer_cond:
  br %i <= 10, ^loop_init_inner_start, ^solve_start;

^loop_init_inner_start:
  %j = 0;
  br ^loop_init_inner_cond;

^loop_init_inner_cond:
  br %j <= 10, ^loop_init_body, ^loop_init_outer_inc;

^loop_init_body:
  %dp[%i][%j] = 0;
  %j = %j + 1;
  br ^loop_init_inner_cond;

^loop_init_outer_inc:
  %i = %i + 1;
  br ^loop_init_outer_cond;

^solve_start:
  %i = 1;
  br ^solve_outer_cond;

^solve_outer_cond:
  br %i <= 10, ^solve_inner_start, ^finish;

^solve_inner_start:
  %j = 1;
  br ^solve_inner_cond;

^solve_inner_cond:
  br %j <= 10, ^solve_body, ^solve_outer_inc;

^solve_body:
  %im1 = %i - 1;
  %jm1 = %j - 1;
  %valX = %X.data[%im1];
  %valY = %Y.data[%jm1];
  br %valX == %valY, ^match, ^mismatch;

^match:
  %prev = %dp[%im1][%jm1];
  %dp[%i][%j] = %prev + 1;
  br ^solve_inner_inc;

^mismatch:
  %up = %dp[%im1][%j];
  %left = %dp[%i][%jm1];
  %mx = select %up > %left, %up, %left;
  %dp[%i][%j] = %mx;
  br ^solve_inner_inc;

^solve_inner_inc:
  %j = %j + 1;
  br ^solve_inner_cond;

^solve_outer_inc:
  %i = %i + 1;
  br ^solve_outer_cond;

^finish:
  %res.len = %dp[10][10];
  %res.match_count = %res.len;
  require %res.len == 5;
  ret %res.len;
}
